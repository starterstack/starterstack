Type: AWS::IAM::Role
Properties:
  AssumeRolePolicyDocument:
    Version: '2012-10-17'
    Statement:
      - Effect: Allow
        Action:
          - 'sts:AssumeRoleWithWebIdentity'
        Principal:
          Federated: !Ref githubOidc
        Condition:
          StringLike:
            token.actions.githubusercontent.com:sub: !Join
              - ''
              - - 'repo:'
                - !Ref GitHubRepoOwner
                - '/'
                - !Ref GitHubRepo
                - ':*'

      - Effect: Allow
        Principal:
          AWS: !Sub 'arn:${AWS::Partition}:iam::${AWS::AccountId}:root'
        Action:
          - 'sts:TagSession'
  Path: /
  ManagedPolicyArns:
    - >-
      arn:aws:iam::aws:policy/ReadOnlyAccess

  Description: !Sub 'Created by Serverless Framework by ${AWS::StackName} to assume ci read only role'
  MaxSessionDuration: 3600
  Tags:
    - Key: 'Name'
      Value: 'dreamstack-ci-read-only'
    - Key: 'ManagedBy'
      Value: 'dreamstack'
