Type: AWS::S3::BucketPolicy
Properties:
  Bucket: !Ref s3Mail
  PolicyDocument:
    Version: '2012-10-17'
    Id: PolicyForCloudFrontPrivateContent
    Statement:
      - Effect: Deny
        Action: 's3:*'
        Resource:
          - !GetAtt s3Mail.Arn
          - !Join
            - ''
            - - !GetAtt s3Mail.Arn
              - '/*'
        Principal: '*'
        Condition:
          Bool:
            'aws:SecureTransport': false
      - Effect: Allow
        Action:
          - 's3:PutObject'
        Resource: !Join
          - ''
          - - !GetAtt s3Mail.Arn
            - '/*'
        Principal:
          Service: ses.amazonaws.com
        Condition:
          Bool:
            'aws:SecureTransport': true
          StringEquals:
            AWS:SourceAccount: !Sub '${AWS::AccountId}'
          ArnLike:
            AWS:SourceArn: !Join
              - ''
              - - !Sub 'arn:${AWS::Partition}:ses:${AWS::Region}:${AWS::AccountId}:receipt-rule-set/'
                - !GetAtt verifySes.RuleSet
                - ':receipt-rule/'
                - !Sub '${AWS::StackName}-ses-rule'
